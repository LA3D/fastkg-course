<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Charles F. Vardeman II">
<meta name="dcterms.date" content="2023-09-12">

<title>A Quick Course on Knowledge Graphs - Working with JSON-LD</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">A Quick Course on Knowledge Graphs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./01_intro.html" rel="" target="">
 <span class="menu-text">Quickstart</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./02_jsonld.html" rel="" target="" aria-current="page">
 <span class="menu-text">Working with JSON-LD</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#uning-json-ld-and-generative-ai-to-construct-a-knowledge-graph" id="toc-uning-json-ld-and-generative-ai-to-construct-a-knowledge-graph" class="nav-link active" data-scroll-target="#uning-json-ld-and-generative-ai-to-construct-a-knowledge-graph">Uning JSON-LD and Generative AI to construct a Knowledge Graph</a></li>
  <li><a href="#using-generative-ai-to-create-column-types." id="toc-using-generative-ai-to-create-column-types." class="nav-link" data-scroll-target="#using-generative-ai-to-create-column-types.">Using Generative AI to create column types.</a>
  <ul class="collapse">
  <li><a href="#transforming-standard-json-to-a-knowledge-graph" id="toc-transforming-standard-json-to-a-knowledge-graph" class="nav-link" data-scroll-target="#transforming-standard-json-to-a-knowledge-graph">Transforming Standard JSON to a Knowledge Graph</a></li>
  </ul></li>
  <li><a href="#our-general-procedure-towards-automated-kg-construction-using-llms" id="toc-our-general-procedure-towards-automated-kg-construction-using-llms" class="nav-link" data-scroll-target="#our-general-procedure-towards-automated-kg-construction-using-llms">Our general procedure towards automated KG Construction using LLMs</a></li>
  <li><a href="#example-using-json-ld-to-construct-a-knowledge-graph-from-wikipedia-tables" id="toc-example-using-json-ld-to-construct-a-knowledge-graph-from-wikipedia-tables" class="nav-link" data-scroll-target="#example-using-json-ld-to-construct-a-knowledge-graph-from-wikipedia-tables">Example: Using JSON-LD to construct a Knowledge Graph from Wikipedia tables</a>
  <ul class="collapse">
  <li><a href="#issues-with-the-dataframe" id="toc-issues-with-the-dataframe" class="nav-link" data-scroll-target="#issues-with-the-dataframe">Issues with the DataFrame:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Working with JSON-LD</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Charles F. Vardeman II </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 12, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="uning-json-ld-and-generative-ai-to-construct-a-knowledge-graph" class="level2">
<h2 class="anchored" data-anchor-id="uning-json-ld-and-generative-ai-to-construct-a-knowledge-graph">Uning JSON-LD and Generative AI to construct a Knowledge Graph</h2>
<p>We have been using the <a href="https://derwen.ai/docs/kgl/tutorial/">kglab tutorial</a> to learn about using W3C web standards to construct knowledge graphs. One particularly useful standard that is briefly touched on in the tutorial is JSON-LD in the <a href="https://derwen.ai/docs/kgl/ex1_0/#serialization-as-json-ld">serialization exercise</a>. This corresponds to <a href="kglab/examples/ex1_0.ipynb">building a knowledge graph with rdflib</a> in the kglab/examples subdirectory.</p>
</section>
<section id="using-generative-ai-to-create-column-types." class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="using-generative-ai-to-create-column-types.">Using Generative AI to create column types.</h2>
<p>We know from <span class="citation" data-cites="koriniColumnTypeAnnotation2023">(<a href="#ref-koriniColumnTypeAnnotation2023" role="doc-biblioref">Korini and Bizer 2023</a>)</span> that GPT-4 does a fairly good job of “Zero-shot” classification of column types. We can use this to create a JSON-LD context for our data. We can then use this context to create a knowledge graph from our data. The video <a href="https://youtu.be/KHNc0WwJ5JA?si=JSNxpd5L3O-6vwyK">Converting Legacy Enterprise Data into Knowledge Graphs with AI and JSON LD | Eliud Polanco</a> does a nice job of explaining the process for Corporate Databases. We will use the same process for our data.</p>
<div class="no-row-height column-margin column-container"><div id="ref-koriniColumnTypeAnnotation2023" class="csl-entry" role="listitem">
Korini, Keti, and Christian Bizer. 2023. <span>“Column <span>Type Annotation</span> Using <span>ChatGPT</span>.”</span> July 30, 2023. <a href="http://arxiv.org/abs/2306.00745">http://arxiv.org/abs/2306.00745</a>.
</div></div><table class="table">
<colgroup>
<col style="width: 6%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>ChatGPT Advanced Data Analysis:</strong></td>
</tr>
<tr class="even">
<td>Absolutely, having a summary and a set of steps can make the process easily reproducible. Here it is:</td>
</tr>
<tr class="odd">
<td>## Summary</td>
</tr>
<tr class="even">
<td>To generate Turtle data from a Pandas DataFrame:</td>
</tr>
<tr class="odd">
<td>1. <strong>Pandas to JSON</strong>: Convert the DataFrame to JSON format using <code>to_json()</code> with <code>orient='records'</code>. 1. <strong>Add UUID and Type to JSON</strong>: Iterate through the JSON objects and add a UUID prefixed by <code>urn:uuid:</code> and a <code>@type</code> with the value <code>Person</code>. 1. <strong>Create JSON-LD Context</strong>: Define a JSON-LD context to map JSON keys to RDF vocabularies. Include mappings for the UUID and <code>rdf:type</code>. 1. <strong>Combine to Form JSON-LD</strong>: Create a JSON-LD object that incorporates both the JSON data and the JSON-LD context. Put the JSON objects inside a <code>@graph</code> array. 1. <strong>Load into RDFlib</strong>: Use RDFlib’s <code>parse()</code> method to load the JSON-LD data into an RDF graph. 1. <strong>Serialize to Turtle</strong>: Use RDFlib’s <code>serialize()</code> method to convert the RDF graph to Turtle format.</td>
</tr>
<tr class="even">
<td>## Code Prompt</td>
</tr>
<tr class="odd">
<td>Here’s a condensed Python code snippet that includes all the steps:</td>
</tr>
<tr class="even">
<td>```python import pandas as pd import json import uuid from rdflib import Graph</td>
</tr>
<tr class="odd">
<td># Step 1: Convert DataFrame to JSON data = {‘Name’: [‘Alice’, ‘Bob’], ‘Age’: [25, 30], ‘Occupation’: [‘Engineer’, ‘Doctor’]} df = pd.DataFrame(data) json_data = df.to_json(orient=‘records’)</td>
</tr>
<tr class="even">
<td># Step 2: Add UUID and Type to JSON json_data_dict = json.loads(json_data) for obj in json_data_dict: obj[“UUID”] = “urn:uuid:” + str(uuid.uuid4()) obj[“<span class="citation" data-cites="type">(<a href="#ref-type" role="doc-biblioref"><strong>type?</strong></a>)</span>”] = “Person”</td>
</tr>
<tr class="odd">
<td># Step 3: Create JSON-LD Context context = { “<span class="citation" data-cites="context">(<a href="#ref-context" role="doc-biblioref"><strong>context?</strong></a>)</span>”: { “UUID”: “<span class="citation" data-cites="id">(<a href="#ref-id" role="doc-biblioref"><strong>id?</strong></a>)</span>”, “Name”: “http://schema.org/name”, “Age”: “http://schema.org/age”, “Occupation”: “http://schema.org/occupation”, “<span class="citation" data-cites="type">(<a href="#ref-type" role="doc-biblioref"><strong>type?</strong></a>)</span>”: “http://www.w3.org/1999/02/22-rdf-syntax-ns#type”, “Person”: “http://xmlns.com/foaf/0.1/Person” } }</td>
</tr>
<tr class="even">
<td># Step 4: Combine to Form JSON-LD json_ld_data = { “<span class="citation" data-cites="context">(<a href="#ref-context" role="doc-biblioref"><strong>context?</strong></a>)</span>”: context[“<span class="citation" data-cites="context">(<a href="#ref-context" role="doc-biblioref"><strong>context?</strong></a>)</span>”], “<span class="citation" data-cites="graph">(<a href="#ref-graph" role="doc-biblioref"><strong>graph?</strong></a>)</span>”: json_data_dict }</td>
</tr>
<tr class="odd">
<td># Step 5: Load into RDFlib g = Graph() g.parse(data=json.dumps(json_ld_data), format=‘json-ld’)</td>
</tr>
<tr class="even">
<td># Step 6: Serialize to Turtle turtle_data = g.serialize(format=‘turtle’) print(turtle_data) ```</td>
</tr>
<tr class="odd">
<td>This will generate Turtle data that includes UUIDs and a <code>rdf:type</code> of <code>Person</code>, aligning with your requirements.</td>
</tr>
</tbody>
</table>
<section id="transforming-standard-json-to-a-knowledge-graph" class="level3">
<h3 class="anchored" data-anchor-id="transforming-standard-json-to-a-knowledge-graph">Transforming Standard JSON to a Knowledge Graph</h3>
<p>The beauty of JSON-LD lies in its ability to transform standard JSON data into a knowledge graph simply and efficiently. By adding a ‘<span class="citation" data-cites="context">(<a href="#ref-context" role="doc-biblioref"><strong>context?</strong></a>)</span>’ to a JSON document, developers can define how the data should be interpreted semantically. This turns a flat data structure into an interconnected web of information, opening up powerful querying and linking possibilities.</p>
</section>
</section>
<section id="our-general-procedure-towards-automated-kg-construction-using-llms" class="level2">
<h2 class="anchored" data-anchor-id="our-general-procedure-towards-automated-kg-construction-using-llms">Our general procedure towards automated KG Construction using LLMs</h2>
<p>I understand the workflow you’ve outlined for constructing a knowledge graph from CSV data using JSON-LD. The process includes six major steps:</p>
<ol type="1">
<li><strong>ETL from CSV to JSON</strong>: Extract, transform, and load the data from a CSV file into a JSON object. Here, we’ll use Python libraries like pandas.</li>
<li><strong>Creating JSON-LD Vocabulary File</strong>: Establish the terms, data types, and definitions in a JSON-LD vocabulary file based on the LLM template.</li>
<li><strong>Convert from JSON to JSON-LD</strong>: Extend the JSON data to JSON-LD by adding the context, linking it with the vocabulary’s IRI, wrapping the data in a <span class="citation" data-cites="graph">(<a href="#ref-graph" role="doc-biblioref"><strong>graph?</strong></a>)</span> object, and assigning unique IDs.</li>
<li><strong>Introduce New Ontology File</strong>: Create another JSON-LD vocabulary file to serve as an ontology.</li>
<li><strong>Link Vocabularies in Another JSON-LD File</strong>: Establish relationships between the vocabularies, definitions, and ontologies in a separate JSON-LD file.</li>
<li><strong>Capturing Provenance Information</strong>: Document metadata about the <span class="citation" data-cites="graph">(<a href="#ref-graph" role="doc-biblioref"><strong>graph?</strong></a>)</span> object to capture its origin and transformation history.</li>
</ol>
</section>
<section id="example-using-json-ld-to-construct-a-knowledge-graph-from-wikipedia-tables" class="level2">
<h2 class="anchored" data-anchor-id="example-using-json-ld-to-construct-a-knowledge-graph-from-wikipedia-tables">Example: Using JSON-LD to construct a Knowledge Graph from Wikipedia tables</h2>
<p>Wikipedia can provide a starting point for structuring and enriching knowledge graphs. For our Navy project, we will want to provide LLM Agents with context for factual information that may have changed since “pre-training” using <a href="https://learn.microsoft.com/en-us/azure/machine-learning/concept-retrieval-augmented-generation?view=azureml-api-2#Technical%20overview%20of%20using%20RAG%20on%20Large%20Language%20Models%20(LLMs)"><code>Retrieval Augmented Generation</code></a>. For our purposes, we want to augment our KG with broader contextual information that may be useful to agents for question and answering. One set of context, is the <a href="https://en.wikipedia.org/wiki/List_of_current_ships_of_the_United_States_Navy">List of current ships of the United States Navy</a> that contain a number of tables that could be useful to add to our knowledge graph. <a href="https://www.wikidata.org/wiki/Wikidata:Main_Page">Wikidata</a> does contain most of the <code>ships</code> but the entities are not always complete. For example, the Wikidata entity page for <a href="https://www.wikidata.org/wiki/Q587557">USS Abraham Lincoln</a> shows a rather rich set of relations including <code>events</code> that correspond to <code>ship naming ceremony</code>, <code>ship commissioning</code>. However, ships like <a href="https://www.wikidata.org/wiki/Q2468798">USS Carter Hall</a> are very basic and don’t contain a lot of information we can extract. Looking at the <a href="https://en.wikipedia.org/w/index.php?title=List_of_current_ships_of_the_United_States_Navy&amp;action=history">History for <code>List of current ships of the United States Navy</code></a> tells us that the page is fairly active and Wikipedia contributors are keeping it more up to date than the Wikidata entries.</p>
<p>Lets’ do a little <a href="https://www.kaggle.com/code/jhoward/getting-started-with-nlp-for-absolute-beginners">Exploratory Data Analysis</a> using large language models similar to <a href="https://www.kaggle.com/code/jhoward/getting-started-with-llms/">Getting Started With LLMs</a>. We will use <a href="https://pypi.org/project/beautifulsoup4/">Beautiful Soup</a> to retreive the Wikipedia page and find the “html tables” in the document.</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_current_ships_of_the_United_States_Navy"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(response.text, <span class="st">'html.parser'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> soup.find_all(<span class="st">"table"</span>)[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now that we have the tables, lets create a pandas dataframe from the table and sanity check that the table is the same as <a href="https://en.wikipedia.org/wiki/List_of_current_ships_of_the_United_States_Navy#Commissioned">what is in the first table</a>.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_html(<span class="bu">str</span>(table))[<span class="dv">0</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_43085/3411228357.py:7: FutureWarning: Passing literal html to 'read_html' is deprecated and will be removed in a future version. To read from a literal string, wrap it in a 'StringIO' object.
  df = pd.read_html(str(table))[0]</code></pre>
</div>
<div id="fig-commissioned" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Ship name</th>
<th data-quarto-table-cell-role="th">Hull number</th>
<th data-quarto-table-cell-role="th">Class</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">Commission date</th>
<th data-quarto-table-cell-role="th">Homeport[2]</th>
<th data-quarto-table-cell-role="th">Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>USS&nbsp;Abraham Lincoln</td>
<td>CVN-72</td>
<td>Nimitz</td>
<td>Aircraft carrier</td>
<td>11 November 1989</td>
<td>San Diego, CA</td>
<td>[3]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>USS&nbsp;Alabama</td>
<td>SSBN-731</td>
<td>Ohio</td>
<td>Ballistic missile submarine</td>
<td>25 May 1985</td>
<td>Bangor, WA</td>
<td>[4]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>USS&nbsp;Alaska</td>
<td>SSBN-732</td>
<td>Ohio</td>
<td>Ballistic missile submarine</td>
<td>25 January 1986</td>
<td>Kings Bay, GA</td>
<td>[5]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>USS&nbsp;Albany</td>
<td>SSN-753</td>
<td>Los Angeles</td>
<td>Attack submarine</td>
<td>7 April 1990</td>
<td>Norfolk, VA</td>
<td>[6]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>USS&nbsp;Alexandria</td>
<td>SSN-757</td>
<td>Los Angeles</td>
<td>Attack submarine</td>
<td>29 June 1991</td>
<td>San Diego, CA</td>
<td>[7] Scheduled to be decommissioned 2026[8]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">233</td>
<td>USS&nbsp;William P. Lawrence</td>
<td>DDG-110</td>
<td>Arleigh Burke</td>
<td>Destroyer</td>
<td>19 May 2011</td>
<td>San Diego, CA</td>
<td>[241]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">234</td>
<td>USS&nbsp;Winston S. Churchill</td>
<td>DDG-81</td>
<td>Arleigh Burke</td>
<td>Destroyer</td>
<td>10 March 2001</td>
<td>Norfolk, VA</td>
<td>[242]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">235</td>
<td>USS&nbsp;Wichita</td>
<td>LCS-13</td>
<td>Freedom</td>
<td>Littoral combat ship</td>
<td>12 January 2019</td>
<td>Mayport, FL</td>
<td>[243] Proposed to be decommissioned 2023[17]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">236</td>
<td>USS&nbsp;Wyoming</td>
<td>SSBN-742</td>
<td>Ohio</td>
<td>Ballistic missile submarine</td>
<td>13 July 1996</td>
<td>Kings Bay, GA</td>
<td>[244]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">237</td>
<td>USS&nbsp;Zumwalt</td>
<td>DDG-1000</td>
<td>Zumwalt</td>
<td>Destroyer</td>
<td>15 October 2016</td>
<td>San Diego, CA</td>
<td>[245]</td>
</tr>
</tbody>
</table>

<p>238 rows × 7 columns</p>
</div>
<figcaption class="figure-caption">Figure&nbsp;1: Dataframe from Wikipedia Commissioned ship table.</figcaption>
</figure>
</div>
</div>
<p>So, if we want to use the column names as the basis for eventually constructing a URI, we unfortunately need to make it web safe and remove spaces and other issues. The other question is “what does a row” represent? If we want to build a knowledge graph of all of the ships of the navy, we might want to consider a basic ontology to start with. The first table is “commissioned” ships and the idea of <code>commisioned</code> is a role relationship since it has a start time and a end time.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>column_names <span class="op">=</span> df.columns.tolist()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>column_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>['Ship name',
 'Hull number',
 'Class',
 'Type',
 'Commission date',
 'Homeport[2]',
 'Note']</code></pre>
</div>
</div>
<p>Before we construct the KG, we need to do a bit of data cleaning so we have a properly constructed Knowledge Graph. We will use ChatGPT “Advanced Data Analysis” as a surrogate for a Large Language Model based Agent.</p>
<hr>
<p><strong>Prompt:</strong> Before we proceed, lets think critically about the dataframe structure. We will use the to_json method to construct a JSON document and then combine it with the context. However, there are some issues with the data, and in particular the format of dates in the dataframe. Think critically and look for issues in the pandas dataframe that will result in inconsistent or invalid KG construction.</p>
<hr>
<p><strong>ChatGPT:</strong> You’re correct; a critical review of the DataFrame structure is essential before proceeding to the knowledge graph construction. This will help ensure that the resulting KG is both consistent and valid. Here are some aspects to consider:</p>
<section id="issues-with-the-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="issues-with-the-dataframe">Issues with the DataFrame:</h3>
<ol type="1">
<li><p><strong>Date Format</strong>: The “Commission date” column is formatted as a string in “YYYY-MM-DD” format. While the <code>to_json</code> method would convert it into a string in JSON, it’s crucial that the context file specifies the date’s type as “xsd:date” to ensure that it’s interpreted correctly in the resulting KG.</p></li>
<li><p><strong>Notes Column</strong>: The “Note” column contains bracketed numbers, which could be references or footnotes. The meaning is unclear, and depending on the intended use, this could introduce ambiguity into the KG.</p></li>
<li><p><strong>Homeport Formatting</strong>: The “Homeport[2]” column contains location data as a string, but it’s not in a standardized geographical format. This could be an issue if geographical querying is required later.</p></li>
<li><p><strong>Column Names</strong>: The column name “Homeport[2]” includes a special character, which may require special handling in both JSON and RDF. It’s generally good practice to use simple, descriptive column names.</p></li>
<li><p><strong>Uniqueness</strong>: The “Hull number” is assumed to be a unique identifier for each ship, but the DataFrame doesn’t enforce this. If there are duplicates, this would result in invalid KG construction.</p></li>
<li><p><strong>Implicit Relationships</strong>: The data implicitly suggests relationships (e.g., a ship belongs to a class and type), but these are not explicitly modeled in the DataFrame. They will be modeled in the KG, but it’s good to be aware of these.</p></li>
<li><p><strong>Role Modeling</strong>: Since we decided to model “Commissioned Ship” as a role, the DataFrame structure doesn’t capture this. Specifically, roles like “Commissioned Ship” often have start and end dates, but our DataFrame only has the start date (“Commission date”).</p></li>
<li><p><strong>Missing Data</strong>: The DataFrame doesn’t indicate missing or null values explicitly, which could be an issue when constructing the KG.</p></li>
<li><p><strong>Data Types</strong>: While pandas will infer the data types, it’s good to explicitly set them, especially for columns that should be interpreted as categorical data (e.g., “Class”, “Type”).</p></li>
</ol>
<p>Addressing these issues before KG construction will help ensure that the resulting KG is both valid and useful for downstream applications. Would you like to address these issues step-by-step?</p>
<div id="fig-pandasjson" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> uuid</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize column names in DataFrame</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>normalized_columns <span class="op">=</span> {col: col.replace(<span class="st">" "</span>, <span class="st">"_"</span>).replace(<span class="st">"["</span>, <span class="st">""</span>).replace(<span class="st">"]"</span>, <span class="st">""</span>) <span class="cf">for</span> col <span class="kw">in</span> column_names}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>df.rename(columns<span class="op">=</span>normalized_columns, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's change the date to be consistent with xsd:date</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># df['Commission_date'] = pd.to_datetime(df['Commission_date']).dt.strftime('%Y-%m-%d')</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert DataFrame to JSON-formatted string</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>df_json_str <span class="op">=</span> df.to_json(orient<span class="op">=</span><span class="st">"records"</span>, indent<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert JSON-formatted string to Python object</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>df_json <span class="op">=</span> json.loads(df_json_str)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Pretty-print the first record</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>pprint(df_json[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>{'Class': 'Nimitz',
 'Commission_date': '11 November 1989',
 'Homeport2': 'San Diego, CA',
 'Hull_number': 'CVN-72',
 'Note': '[3]',
 'Ship_name': 'USS\xa0Abraham Lincoln',
 'Type': 'Aircraft carrier'}</code></pre>
</div>
<figcaption class="figure-caption">Figure&nbsp;2: <strong>?(caption)</strong></figcaption>
</figure>
</div>
<p>Looking at this JSON version of the first row of the dataframe, we can see some small data problems that we might want to address. First the “Commission_data” is not in an xsd:date format our knowledge graph would expect for a date literal. Second, the “note” field isn’t very useful without the note. For the “Null_number”, Homeport2, Class, Type and Ship Name, we will eventually want to align to wikidata properties. Remember, the Column names serve as properties to link “whatever” the row semantics are to the literal values of the table.</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Cleaning Steps</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Replace special characters in 'Ship_name'</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Ship_name'</span>] <span class="op">=</span> df[<span class="st">'Ship_name'</span>].<span class="bu">str</span>.replace(<span class="st">'</span><span class="ch">\xa0</span><span class="st">'</span>, <span class="st">' '</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Standardize 'Commission_date' to ISO 8601 format</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Commission_date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Commission_date'</span>]).dt.strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Remove 'Note' field</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">'Note'</span>])</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Standardize 'Homeport' field name</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>df.rename(columns<span class="op">=</span>{<span class="st">'Homeport2'</span>: <span class="st">'Homeport'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert cleaned DataFrame to JSON</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>json_data_cleaned <span class="op">=</span> df.to_json(orient<span class="op">=</span><span class="st">'records'</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert JSON-formatted string to Python object</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>df_json <span class="op">=</span> json.loads(json_data_cleaned)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Pretty-print the first record</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>pprint(df_json[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>{'Class': 'Nimitz',
 'Commission_date': '1989-11-11',
 'Homeport': 'San Diego, CA',
 'Hull_number': 'CVN-72',
 'Ship_name': 'USS Abraham Lincoln',
 'Type': 'Aircraft carrier'}</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conventions for naming in RDF
</div>
</div>
<div class="callout-body-container callout-body">
<p>The prevalent practice in RDF ontology naming is to employ <a href="https://en.wikipedia.org/wiki/Camel_case">Camel case</a>. Specifically, <strong>lower camel case</strong> is preferred for relationships, which include properties and edges in the knowledge graph. In contrast, <strong>upper camel case</strong> is advised for Classes and types, representing nodes in the knowledge graph. It’s worth noting that while camel case serves as an implicit identifier, more explicit identifiers such as <code>rdf:Property</code> are also commonly used, especially in the context of large language models.</p>
<p><strong>For example:</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"@context"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"@vocab"</span><span class="fu">:</span> <span class="st">"http://schema.org/"</span><span class="fu">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"@id"</span><span class="fu">:</span> <span class="st">"rdf:Property"</span><span class="fu">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"@type"</span><span class="fu">:</span> <span class="st">"xsd:string"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"@type"</span><span class="fu">:</span> <span class="st">"Person"</span><span class="fu">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"John Doe"</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>To generate a RDF knowledge graph from the JSON, we also need a <span class="citation" data-cites="context">(<a href="#ref-context" role="doc-biblioref"><strong>context?</strong></a>)</span> that defines our JSON <code>keys</code>.</p>
<div id="fig-turtle" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdflib <span class="im">import</span> Graph, URIRef</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Add UUID and Type to JSON</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>json_data_cleaned_dict <span class="op">=</span> json.loads(json_data_cleaned)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> obj <span class="kw">in</span> json_data_cleaned_dict:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    obj[<span class="st">"UUID"</span>] <span class="op">=</span> <span class="st">"urn:uuid:"</span> <span class="op">+</span> <span class="bu">str</span>(uuid.uuid4())</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    obj[<span class="st">"@type"</span>] <span class="op">=</span> <span class="st">"Ship"</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create JSON-LD Context with SKOS definitions and XSD literals</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>context_with_skos_and_xsd <span class="op">=</span> {</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"@context"</span>: {</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"UUID"</span>: <span class="st">"@id"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Class"</span>: {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@id"</span>: <span class="st">"http://example.org/Class"</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@type"</span>: <span class="st">"xsd:string"</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skos:definition"</span>: <span class="st">"The class of the ship."</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Commission_date"</span>: {</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@id"</span>: <span class="st">"http://example.org/Commission_date"</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@type"</span>: <span class="st">"xsd:date"</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skos:definition"</span>: <span class="st">"The date the ship was commissioned."</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Homeport"</span>: {</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@id"</span>: <span class="st">"http://example.org/Homeport"</span>,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@type"</span>: <span class="st">"xsd:string"</span>,</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skos:definition"</span>: <span class="st">"The homeport of the ship."</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Hull_number"</span>: {</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@id"</span>: <span class="st">"http://example.org/Hull_number"</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@type"</span>: <span class="st">"xsd:string"</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skos:definition"</span>: <span class="st">"The hull number of the ship."</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ship_name"</span>: {</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@id"</span>: <span class="st">"http://example.org/Ship_name"</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@type"</span>: <span class="st">"xsd:string"</span>,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skos:definition"</span>: <span class="st">"The name of the ship."</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Type"</span>: {</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@id"</span>: <span class="st">"http://example.org/Type"</span>,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">"@type"</span>: <span class="st">"xsd:string"</span>,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skos:definition"</span>: <span class="st">"The type of the ship."</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"@type"</span>: <span class="st">"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ship"</span>: <span class="st">"http://example.org/Ship"</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Combine to Form JSON-LD</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>json_ld_data_cleaned <span class="op">=</span> {</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"@context"</span>: context_with_skos_and_xsd[<span class="st">"@context"</span>],</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"@graph"</span>: json_data_cleaned_dict</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Load into RDFlib</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>g_cleaned <span class="op">=</span> Graph()</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>g_cleaned.parse(data<span class="op">=</span>json.dumps(json_ld_data_cleaned), <span class="bu">format</span><span class="op">=</span><span class="st">'json-ld'</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Serialize to Turtle</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>turtle_data <span class="op">=</span> g_cleaned.serialize(<span class="bu">format</span><span class="op">=</span><span class="st">'turtle'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<figcaption class="figure-caption">Figure&nbsp;3: <strong>?(caption)</strong></figcaption>
</figure>
</div>
<div id="fig-turtleout" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="cell-output cell-output-stdout">
<pre><code>@prefix ns1: &lt;http://example.org/&gt; .
&lt;urn:uuid:0080c026-d273-450a-a687-5482a792447a&gt; a ns1:Ship ;
    ns1:Class "Ticonderoga"^^&lt;xsd:string&gt; ;
    ns1:Commission_date "1991-01-12"^^&lt;xsd:date&gt; ;
    ns1:Homeport "Pearl Harbor, HI"^^&lt;xsd:string&gt; ;
    ns1:Hull_number "CG-65"^^&lt;xsd:string&gt; ;
    ns1:Ship_name "USS Chosin"^^&lt;xsd:string&gt; ;
    ns1:Type "Cruiser"^^&lt;xsd:string&gt; .
&lt;urn:uuid:00d02856-4403-45c4-a056-1e9e7ec826ee&gt; a ns1:Ship ;
    ns1:Class "Arleigh Burke"^^&lt;xsd:string&gt; ;
    ns1:Commission_date "1995-10-14"^^&lt;xsd:date&gt; ;
    ns1:Homeport "San Diego, CA"^^&lt;xsd:string&gt; ;
    ns1:Hull_number "DDG-62"^^&lt;xsd:string&gt; ;
    ns1:Ship_name "USS Fitzgerald"^^&lt;xsd:string&gt; ;
    ns1:Type "Destroyer"^^&lt;xsd:string&gt; .</code></pre>
</div>
<figcaption class="figure-caption">Figure&nbsp;4: <strong>?(caption)</strong></figcaption>
</figure>
</div>
<div class="cell" data-execution_count="43">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to pretty-print Turtle string with indentation and line returns</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pretty_print_turtle(turtle_str):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> turtle_str.strip().split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    pretty_lines <span class="op">=</span> []</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> lines:</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">';'</span> <span class="kw">in</span> line <span class="kw">and</span> <span class="st">'.'</span> <span class="kw">in</span> line:</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>            triples <span class="op">=</span> line.split(<span class="st">';'</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            formatted_triples <span class="op">=</span> <span class="st">' ;</span><span class="ch">\n</span><span class="st">    '</span>.join(triple.strip() <span class="cf">for</span> triple <span class="kw">in</span> triples)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            pretty_lines.append(formatted_triples.rstrip(<span class="st">' .'</span>) <span class="op">+</span> <span class="st">' .'</span> )</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            pretty_lines.append(line)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(pretty_lines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>



</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>